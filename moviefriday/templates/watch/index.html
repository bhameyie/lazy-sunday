{% extends 'base.html' %}
{% block header %}
    <h1>{% block title %}{{ movie.title }}{% endblock %}</h1>
    {% if g.user %}
        <a class="action" href="#">Special for {{ g.user.username }}</a>
    {% endif %}
{% endblock %}

{% block content %}

    {% if movie.is_mp4 %}
        <video width="320" height="240" controls>
            <source src="{{ url_for("watch.mp4_video",movie_id= movie.id) }}" type="video/mp4">
        </video>
    {% else %}
        <b>Will be loading m3u8 file here</b>

        <video-js id=vid1 width=600 height=300 class="vjs-default-skin" controls>
        </video-js>
        <script src="https://vjs.zencdn.net/7.2.3/video.js"></script>
        <script src="https://unpkg.com/@videojs/http-streaming@1.3.1/dist/videojs-http-streaming.min.js"></script>
         <script>
        var player = videojs('vid1', {
            controls: true,
            autoplay: false,
            preload: 'auto',
        });
        player.src({
            src: '{{ url_for("watch.hsl_video",movie_id=movie.id) }}',
            type: 'application/x-mpegURL',
            // withCredentials: true
        });
        player.on('progress', function () {
            console.log('progressing;')
            console.log(player.currentTime());
            console.log(player.duration());

            var progress = player.currentTime()*100.0/player.duration();
            console.log(progress);
        })

        player.on('ratechange', function () {
            console.log('rate of play is  changing....')
        });

        player.on('playing',function(){
            console.log('it restarted....should force into full screen mode here....assuming isnt already full screen')
        });

        player.on('play',function(){
            console.log('it started....should force into full screen mode here;')
        });

        player.on('stalled', function () {
            console.log('problem getting data. things are stalled')
        });

        player.on('suspend', function () {
            console.log('stream suspended')
        });

        player.on('emptied', function () {
            console.log('nothing else to play...?');
        });

        player.on('ended', function () {
            console.log('done!');
        });

        player.on('canplaythrough', function () {
            console.log('smooth sailing');
        });

        player.ready(function () {
            player.play();

           // var hls = player.tech().hls;
           // player.currentTime(171.236112);

            console.log(hls.duration())
        });

        player.on('error', function (x) {
            console.log(x)
        });
        player.on('loadstart', function (x) {
            console.log(x)
        });
    </script>
    {% endif %}
{% endblock %}